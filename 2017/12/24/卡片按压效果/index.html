<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>卡片按压效果 | bersaty</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">卡片按压效果</h1><a id="logo" href="/.">bersaty</a><p class="description">bersaty’s blog!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">卡片按压效果</h1><div class="post-meta">Dec 24, 2017<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>锁屏界面的一种新交互，可以碰触音乐的界面达到卡片按压的效果，如下图所示：</p>
<p><img src="/images/show.gif" alt=""></p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>xml文件添加对应的View：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">widget.CircleImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/image"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"300dp"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>需要在代码里面设置BitMap才会有圆形图效果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imageView = (CircleImageView) findViewById(R.id.image);</span><br><span class="line">Drawable drawable = getResources().getDrawable(R.drawable.foxgirl);</span><br><span class="line">BitmapDrawable bitmapDrawable = (BitmapDrawable)drawable;</span><br><span class="line">Bitmap bitmap = bitmapDrawable.getBitmap();</span><br><span class="line">imageView.setImageBitmap(bitmap);</span><br></pre></td></tr></table></figure></p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>最主要的实现方式,使用canmera对y轴和x轴进行旋转，旋转的时候使用pretranslate和posttranslate设置旋转中心。</p>
<p>旋转中心设置不同的效果体验，旋转中心为view的中心时，围绕中心旋转，按旁边时旁边会压下去，但是中间会鼓起来的。边缘会被拉伸变型，类似一种果冻的效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//旋转中心为view 中心</span></span><br><span class="line"><span class="keyword">float</span> centerX = <span class="keyword">this</span>.getWidth() /<span class="number">2</span>;</span><br><span class="line"><span class="keyword">float</span> centerY = <span class="keyword">this</span>.getHeight() /<span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/images/music1.gif" alt=""></p>
<p>旋转中心为对称点时，就是一个平面在空间里上下移动的效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//旋转中心为手指按压的对称点</span></span><br><span class="line"><span class="keyword">float</span> centerX = <span class="keyword">this</span>.getWidth() - x;</span><br><span class="line"><span class="keyword">float</span> centerY = <span class="keyword">this</span>.getHeight() - y;</span><br></pre></td></tr></table></figure>
<p><img src="/images/music2.gif" alt=""></p>
<p>阴影效果的实现是使用了v4库的CircleImageView的实现方式，使用shapedrawable生成阴影drawable绘制：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">OvalShadow</span> <span class="keyword">extends</span> <span class="title">OvalShape</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> RadialGradient mRadialGradient;</span><br><span class="line">        <span class="keyword">private</span> Paint mShadowPaint;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mCircleDiameter;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">OvalShadow</span><span class="params">(<span class="keyword">int</span> shadowRadius, <span class="keyword">int</span> circleDiameter)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">            mShadowPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">            mShadowRadius = shadowRadius;</span><br><span class="line">            mCircleDiameter = circleDiameter;</span><br><span class="line">            mRadialGradient = <span class="keyword">new</span> RadialGradient(mCircleDiameter / <span class="number">2</span>, mCircleDiameter / <span class="number">2</span>,</span><br><span class="line">                    mShadowRadius, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;</span><br><span class="line">                    FILL_SHADOW_COLOR, Color.TRANSPARENT</span><br><span class="line">            &#125;, <span class="keyword">null</span>, Shader.TileMode.CLAMP);</span><br><span class="line">            mShadowPaint.setShader(mRadialGradient);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas, Paint paint)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> viewWidth = CircleImageView.<span class="keyword">this</span>.getWidth();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> viewHeight = CircleImageView.<span class="keyword">this</span>.getHeight();</span><br><span class="line">            canvas.drawCircle(viewWidth / <span class="number">2</span>, viewHeight / <span class="number">2</span>, (mCircleDiameter / <span class="number">2</span> + mShadowRadius),</span><br><span class="line">                    mShadowPaint);</span><br><span class="line">            canvas.drawCircle(viewWidth / <span class="number">2</span>, viewHeight / <span class="number">2</span>, (mCircleDiameter / <span class="number">2</span>), paint);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ShapeDrawable <span class="title">setShadow</span><span class="params">(<span class="keyword">int</span> color, <span class="keyword">final</span> <span class="keyword">float</span> radius)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> density = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> diameter = (<span class="keyword">int</span>) (radius * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> shadowYOffset = (<span class="keyword">int</span>) (density * Y_OFFSET);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> shadowXOffset = (<span class="keyword">int</span>) (density * X_OFFSET);</span><br><span class="line"></span><br><span class="line">        mShadowRadius = (<span class="keyword">int</span>) (density * SHADOW_RADIUS);</span><br><span class="line"></span><br><span class="line">        ShapeDrawable circle;</span><br><span class="line">        OvalShape oval = <span class="keyword">new</span> OvalShadow(mShadowRadius, diameter);</span><br><span class="line">        circle = <span class="keyword">new</span> ShapeDrawable(oval);</span><br><span class="line">        setLayerType(LAYER_TYPE_SOFTWARE, circle.getPaint());</span><br><span class="line">        circle.getPaint().setShadowLayer(mShadowRadius, shadowXOffset, shadowYOffset,</span><br><span class="line">                KEY_SHADOW_COLOR);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> padding = mShadowRadius;</span><br><span class="line">        <span class="comment">// set padding so the inner image sits correctly within the shadow.</span></span><br><span class="line">        setPadding(padding, padding, padding, padding);</span><br><span class="line">        circle.getPaint().setColor(color);</span><br><span class="line"><span class="comment">//        setBackgroundDrawable(circle);</span></span><br><span class="line">        <span class="keyword">return</span> circle;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>添加了阴影的效果如下：<br><img src="/images/shadow.gif" alt=""></p>
</div><div class="tags"><a href="/tags/view/">view</a></div><div class="post-nav"><a class="pre" href="/2018/03/27/游戏/">游戏</a><a class="next" href="/2017/12/20/Hexo-github配置博客/">Hexo+github配置博客</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'bersaty## Your GitHub ID, e.g. username',
  repo: 'https://github.com/bersaty/bersaty.github.io.git## The repository to store your comments, make sure you're the repo's owner, e.g. imsun.github.io',
  oauth: {
    client_id: '26ae80fa927b9e72774e## GitHub client ID, e.g. 75752dafe7907a897619',
    client_secret: 'dc3116caf8e351394ed5df14b22ce502c7198a17## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/Android面试/" style="font-size: 15px;">Android面试</a> <a href="/tags/game/" style="font-size: 15px;">game</a> <a href="/tags/view/" style="font-size: 15px;">view</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/29/review/">interview</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/27/游戏/">游戏</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/24/卡片按压效果/">卡片按压效果</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/20/Hexo-github配置博客/">Hexo+github配置博客</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.jianshu.com/u/4cb5b23aa64a" title="我的简书" target="_blank">我的简书</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">bersaty.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>